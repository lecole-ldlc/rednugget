<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>Smoothed D3.js Radar Chart</title>

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
          integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">

    <!-- D3.js
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
 -->

    <link href='main.css' rel='stylesheet' type='text/css'>
    <script src="https://d3js.org/d3.v4.min.js"></script>

</head>
<body>

<h1>La mine des pépites</h1>

<div class="container">
    <div class="row">
        <div class="col-sm-12 col-lg-6" id="CYN">
        </div>
        <div class="col-sm-12 col-lg-6 ">
            <div class="col"><p class="slider_title">Humour</p><svg class="slider_svg" id="slider3" width="500" height="60" data-slider="Humour"></svg></div>
            <div class="col"><p class="slider_title">Durée moyenne</p><svg class="slider_svg" id="slider4" width="500" height="70" data-slider="Durée moyenne"></svg></div>
            <div class="col"><p class="slider_title">Abonnés</p><svg class="slider_svg" id="slider5" width="500" height="70" data-slider="Abonnés"></svg></div>
            <div class="col"><p class="slider_title">Fréquence</p><svg class="slider_svg" id="slider6" width="500" height="70" data-slider="Fréquence"></svg></div>
            <div class="col"><p class="slider_title">Réflexion</p><svg class="slider_svg" id="slider1" width="500" height="70" data-slider="Réflexion"></svg></div>
            <div class="col"><p class="slider_title">Originalité</p><svg class="slider_svg" id="slider2" width="500" height="70" data-slider="Originalité"></svg></div>
        </div>
    </div>
</div>

<!--<button onclick="whowins()">Oui</button>-->
<p id="result"></p>
<p id="ratio"></p>
<p id="reaction"></p>
<br><br>
<div class="row justify-content-start" id="small_multiple"></div>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"
        integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
        crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
        crossorigin="anonymous"></script>

<script src="radarChart_v4.js"></script>
<script>
    var data_slider = [
        [//editable
            {axis: "Humour", value: 0.5},
            {axis: "Durée moyenne", value: 0.5},
            {axis: "Abonnés", value: 0.5},
            {axis: "Fréquence", value: 0.5},
            {axis: "Réflexion", value: 0.5},
            {axis: "Originalité", value: 0.5}
        ]
    ];

    function drawSlider(element) {
        var svg = d3.select(element),
            margin = {right: 50, left: 50},
            width = +svg.attr("width") - margin.left - margin.right,
            height = +svg.attr("height");
        var selector = element;
        var key = $(selector).attr("data-slider");

        data_slider[0].forEach(function (d, index) {
            if (d.axis == key) {
                sliderValue = data_slider[0][index].value;
            }
        });

        var x = d3.scaleLinear()
            .domain([0, 1])
            .range([0, width])
            .clamp(true);

        var slider = svg.append("g")
            .attr("class", "slider")
            .attr("transform", "translate(" + margin.left + "," + height / 2 + ")");

        slider.append("line")
            .attr("class", "track")
            .attr("x1", x.range()[0])
            .attr("x2", x.range()[1])
            .select(function () {
                return this.parentNode.appendChild(this.cloneNode(true));
            })
            .attr("class", "track-inset")
            .select(function () {
                return this.parentNode.appendChild(this.cloneNode(true));
            })
            .attr("class", "track-overlay")
            .call(d3.drag()
                .on("start.interrupt", function () {
                    slider.interrupt();
                })
                .on("start drag", function () {
                    sliderData(x.invert(d3.event.x));
                }));

//        slider.insert("g", ".track-overlay")
//            .attr("class", "ticks")
//            .attr("transform", "translate(0," + 30 + ")")
//            .selectAll("text")
//            .data(x.ticks(10))
//            .enter().append("text")
//            .attr("x", x)
//            .attr("text-anchor", "middle")
//            .text(function (d) {
//                return d;
//            });

        var handle = slider.insert("circle", ".track-overlay")
            .attr("class", "handle")
            .attr("cx", x(sliderValue))
            .attr("r", 10);

        function sliderData(h) {
            handle.attr("cx", x(h));
            sliderValue = Math.round(x.invert(d3.event.x) * 100) / 100;
            $('#sliderData1').html(sliderValue);

            data_slider[0].forEach(function (d, index) {
                if (d.axis == key) {
                    data_slider[0][index].value = sliderValue;
                }
            });
            $("#CYN").html("");
            RadarChart("#CYN", data_slider, " ", customRadarChartOptions);
            console.log("sliderValue= " + sliderValue);
            whowins();
        }
    }

    $(".slider_svg").each(function (e) {
        drawSlider("#" + $(this).attr('id'));
    })

</script>
<script>
    var sm_ids = 1;
    /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */

    //////////////////////////////////////////////////////////////
    //////////////////////// Set-Up //////////////////////////////
    //////////////////////////////////////////////////////////////
    var margin = {top: 5, right: 20, bottom: 30, left: 20},
        width = Math.min(400, window.innerWidth - 10) - margin.left - margin.right,
        height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);

    var customMargin = {top: 30, right: 60, bottom: 80, left: 60},
        width = Math.min(400, window.innerWidth - 10) - margin.left - margin.right,
        height = Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);

    //////////////////////////////////////////////////////////////
    ////////////////////////// Data //////////////////////////////
    //////////////////////////////////////////////////////////////

    var data1 = [
        [//HHE
            {axis: "Humour", value: 0.48},
            {axis: "Durée moyenne", value: 0.20},
            {axis: "Abonnés", value: 0.60},
            {axis: "Fréquence", value: 0.40},
            {axis: "Réflexion", value: 0.70},
            {axis: "Originalité", value: 0.83}
        ]
    ];

    var data2 = [
        [//Cocovoit
            {axis: "Humour", value: 0.78},
            {axis: "Durée moyenne", value: 0.20},
            {axis: "Abonnés", value: 0.10},
            {axis: "Fréquence", value: 0.70},
            {axis: "Réflexion", value: 0.25},
            {axis: "Originalité", value: 0.68}
        ]
    ];

    var data3 = [
        [//This Place
            {axis: "Humour", value: 0.53},
            {axis: "Durée moyenne", value: 0.40},
            {axis: "Abonnés", value: 0.60},
            {axis: "Fréquence", value: 0.20},
            {axis: "Réflexion", value: 0.83},
            {axis: "Originalité", value: 0.70}
        ]
    ];

    var data4 = [
        [//HugoDécrypte
            {axis: "Humour", value: 0.23},
            {axis: "Durée moyenne", value: 0.30},
            {axis: "Abonnés", value: 0.60},
            {axis: "Fréquence", value: 0.60},
            {axis: "Réflexion", value: 0.68},
            {axis: "Originalité", value: 0.58}
        ]
    ];

    var data5 = [
        [//Startup Heroes
            {axis: "Humour", value: 0.75},
            {axis: "Durée moyenne", value: 0.10},
            {axis: "Abonnés", value: 0.30},
            {axis: "Fréquence", value: 0.10},
            {axis: "Réflexion", value: 0.30},
            {axis: "Originalité", value: 0.83}
        ]
    ];

    var data6 = [
        [//Stupid Economics
            {axis: "Humour", value: 0.20},
            {axis: "Durée moyenne", value: 0.30},
            {axis: "Abonnés", value: 0.30},
            {axis: "Fréquence", value: 0.40},
            {axis: "Réflexion", value: 0.75},
            {axis: "Originalité", value: 0.60}
        ]
    ];

    var data7 = [
        [//Tu mourras moins bete
            {axis: "Humour", value: 0.68},
            {axis: "Durée moyenne", value: 0.20},
            {axis: "Abonnés", value: 0.70},
            {axis: "Fréquence", value: 0.60},
            {axis: "Réflexion", value: 0.65},
            {axis: "Originalité", value: 0.78}
        ]
    ];

    var data8 = [
        [//Leo Duff
            {axis: "Humour", value: 0.53},
            {axis: "Durée moyenne", value: 0.40},
            {axis: "Abonnés", value: 0.50},
            {axis: "Fréquence", value: 0.50},
            {axis: "Réflexion", value: 0.70},
            {axis: "Originalité", value: 0.65}
        ]
    ];

    var data9 = [
        [//ETLMSF
            {axis: "Humour", value: 0.70},
            {axis: "Durée moyenne", value: 0.40},
            {axis: "Abonnés", value: 0.50},
            {axis: "Fréquence", value: 0.50},
            {axis: "Réflexion", value: 0.80},
            {axis: "Originalité", value: 0.78}
        ]
    ];

    var data10 = [
        [//Nicolas Meyrieux
            {axis: "Humour", value: 0.68},
            {axis: "Durée moyenne", value: 0.30},
            {axis: "Abonnés", value: 0.50},
            {axis: "Fréquence", value: 0.40},
            {axis: "Réflexion", value: 0.70},
            {axis: "Originalité", value: 0.63}
        ]
    ];

    var data11 = [
        [//Le Sense of Wonder
            {axis: "Humour", value: 0.28},
            {axis: "Durée moyenne", value: 0.50},
            {axis: "Abonnés", value: 0.40},
            {axis: "Fréquence", value: 0.20},
            {axis: "Réflexion", value: 0.85},
            {axis: "Originalité", value: 0.68}
        ]
    ];

    var data_full = [
        {
            name : "Horror Humanum Est",
            url : "https://rednugget.fr/21-10-2017/horror-humanum-est/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/10/Thumbnail_HHEv2.png",
            data : data1
        },
        {
            name : "Cocovoit",
            url : "https://rednugget.fr/25-10-2017/cocovoit/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/10/Thumbnail_Cocovoit.png",
            data : data2
        },
        {
            name : "This Place",
            url : "https://rednugget.fr/28-10-2017/this-place/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/10/Thumbnail_ThisPlace.png",
            data : data3
        },
        {
            name : "Hugo Décrypte",
            url : "https://rednugget.fr/01-11-2017/hugodecrypte/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_Hugo.jpg",
            data : data4
        },
        {
            name : "Startup Heroes",
            url : "https://rednugget.fr/03-11-2017/startup-heroes/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_StartupHeroes.jpg",
            data : data5
        },
        {
            name : "Stupid Economics",
            url : "https://rednugget.fr/08-11-2017/stupid-economics/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_StupidEconomics.png",
            data : data6
        },
        {
            name : "Tu mourras moins bete",
            url : "https://rednugget.fr/10-11-2017/tu-mourras-moins-bete/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_TMMB.jpg",
            data : data7
        },
        {
            name : "Léo Duff",
            url : "https://rednugget.fr/15-11-2017/leo-duff/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_LeoDuff.jpg",
            data : data8
        },
        {
            name : "Et tout le monde s'en fout",
            url : "https://rednugget.fr/18-11-2017/et-tout-le-monde-s-en-fout/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_ETLMSF.jpg",
            data : data9
        },
        {
            name : "Nicolas Meyrieux",
            url : "https://rednugget.fr/21-11-2017/nicolas-meyrieux/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_NicolasMeyrieux.png",
            data : data10
        },
        {
            name : "Le Sense of Wonder",
            url : "https://rednugget.fr/25-11-2017/le-sense-of-wonder/",
            urlimg : "https://rednugget.fr/wp-content/uploads/2017/11/Thumbnail_SenseOfWonder.jpg",
            data : data11
        },
    ];




    //////////////////////////////////////////////////////////////
    //////////////////// Draw the Chart //////////////////////////
    //////////////////////////////////////////////////////////////
    var color = d3.scaleOrdinal()
        .range(["#f43131", "#353535", "#f9f9f9", "#14649F", "#6F835A", "#8B7E66", "#8B2252"]);

    var radarChartOptions = {
        w: width*0.4,
        h: height*0.4,
        margin: margin,
        maxValue: 0.5,
        levels: 5,
        roundStrokes: true,
        color: color,
        showLabel: false
    };

    var customRadarChartOptions = {
        w: width*1.2,
        h: height*1.2,
        margin: customMargin,
        maxValue: 0.5,
        levels: 5,
        roundStrokes: true,
        color: color,
        showLabel: true
    };

    //Call function to draw the Radar chart
    data_full.forEach(function(d){
        RadarChart("#small_multiple", d.data, d.name, radarChartOptions);
    });
    RadarChart("#CYN", data_slider, "Nugget Builder", customRadarChartOptions);

    //Custom nugget drawn by user, stocked in data_slider


    //This variable needs to go through all the nuggets to be compared with nC

    function whowins () {
        var i=0;
        var t=0;
        var result=1.5;
        var winner = "";
        var winner_url= "";
        var winner_urlimg= "";
        var nugget_ratio= 0;

        for (n=0;n<15;n++){

            nC = {
                'h':data_slider[0][0]["value"],
                'd':data_slider[0][1]["value"],
                'a':data_slider[0][2]["value"],
                'f':data_slider[0][3]["value"],
                'r':data_slider[0][4]["value"],
                'o':data_slider[0][5]["value"]
            };
            n2 = {
                'h':data_full[i]["data"][0][0]["value"],
                'd':data_full[i]["data"][0][1]["value"],
                'a':data_full[i]["data"][0][2]["value"],
                'f':data_full[i]["data"][0][3]["value"],
                'r':data_full[i]["data"][0][4]["value"],
                'o':data_full[i]["data"][0][5]["value"]
            };

            t=distance(nC,n2);
            if (result>t) {
                result = t;
                winner = data_full[i]["name"];
                winner_url = data_full[i]["url"];
                winner_urlimg = data_full[i]["urlimg"];
                nugget_ratio = Math.round(100 - result*100);
            }
            i++;
            console.log(n2, result, winner);
            //console.log(n2);
            $("#result").html("La pépite la plus proche :  " + " <a target=_blank href= " + winner_url + " ><img src=" + winner_urlimg + " " + winner + "</a>");
            $("#ratio").html("Niveau de correspondance : " + nugget_ratio + "%");
            if (result>1){
                $("#reaction").html("Mais... arrêtes de faire n'importe quoi ! C'est pas DU TOUT une pépite en fait.")
            }
            else if (result<1 && result>0.7){
                $("#reaction").html("Bon ça correspond mais pas trop, je te garantis rien !")
            }
            else if (result<0.7 && result>0.4){
                $("#reaction").html("Pas mal ta pépite, tu devrais trouver ton bonheur sur cette chaine.")
            }
            else if (result<0.4 && result>0.1){
                $("#reaction").html("On a trouvé une pépite qui ressemble beaucoup à la tienne. ;)")
            }
            else if (result<0.1){
                $("#reaction").html("OK on a trouvé la pépite de tes rêves ! :o")
            }
        }
    }

    function distance(nC, n2){
        var d = 0.0;
        for(var prop in nC){
            d += (nC[prop]-n2[prop])*(nC[prop]-n2[prop])
        }
        return Math.sqrt(d);
    }

</script>


</body>
</html>